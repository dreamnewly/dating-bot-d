<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#ff4757" />
  <title>EvilCorp: Dating App</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* ==========================================================
       CSS STYLES
       ========================================================== */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Plus Jakarta Sans', system-ui, -apple-system, sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      overflow-x: hidden;
      transition: background .35s ease, color .25s ease;
    }
    button, input, select, textarea { font: inherit; }
    a { color: inherit; text-decoration: none; }

    :root {
      --primary: #FF4757;
      --primary-hover: #ff6b81;
      --secondary: #5352ed;
      --accent: #2ed573;
      --warning: #ffa502;
      --bg-body: #f2f4fb;
      --bg-card: #ffffff;
      --bg-glass: rgba(255,255,255,.78);
      --bg-input: #f7f9ff;
      --text-main: #1f2330;
      --text-sub: #6c7486;
      --text-light: #a4adbd;
      --radius-xl: 28px;
      --radius-lg: 22px;
      --radius-md: 16px;
      --shadow-sm: 0 4px 10px rgba(0,0,0,.06);
      --shadow-md: 0 10px 24px rgba(0,0,0,.08);
      --shadow-lg: 0 24px 60px rgba(0,0,0,.12);
      --backdrop: blur(18px);
      --ease: cubic-bezier(.2,.9,.2,1);
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --gradient-primary: linear-gradient(135deg, #FF4757 0%, #ff6b81 100%);
    }

    [data-theme="dark"] {
      --bg-body: #0f111a;
      --bg-card: #1b1f2c;
      --bg-glass: rgba(27,31,44,.78);
      --bg-input: #2a2f42;
      --text-main: #ffffff;
      --text-sub: #a9b2c6;
      --text-light: #65708b;
      --shadow-sm: 0 4px 10px rgba(0,0,0,.35);
      --shadow-md: 0 10px 24px rgba(0,0,0,.45);
      --shadow-lg: 0 24px 60px rgba(0,0,0,.55);
    }

    body::before, body::after {
      content: "";
      position: fixed;
      width: 520px;
      height: 520px;
      border-radius: 50%;
      filter: blur(90px);
      opacity: .18;
      z-index: -1;
      animation: floatBg 18s ease-in-out infinite alternate;
    }
    body::before { background: var(--primary); top: -12%; left: -12%; }
    body::after { background: var(--secondary); bottom: -12%; right: -12%; animation-delay: -8s; }

    @keyframes floatBg {
      0% { transform: translate(0,0) scale(1); }
      50% { transform: translate(40px,-30px) scale(1.06); }
      100% { transform: translate(-30px,25px) scale(1); }
    }
    @keyframes slideUpFade {
      from { opacity: 0; transform: translateY(18px) scale(.99); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes popIn {
      0% { transform: scale(.6); opacity: 0; }
      70% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(255,71,87,.4); }
      70% { box-shadow: 0 0 0 16px rgba(255,71,87,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,71,87,0); }
    }
    
    /* Animation Placeholders */
    @keyframes logoFloat { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
    @keyframes logoGlow { 0%, 100% { filter: drop-shadow(0 0 5px rgba(255,71,87,0.2)); } 50% { filter: drop-shadow(0 0 12px rgba(255,71,87,0.5)); } }

    .container {
      max-width: 1320px; margin: 0 auto; padding: 18px; min-height: 100vh;
      display: flex; flex-direction: column; gap: 16px;
    }

    header {
      position: sticky; top: 12px; z-index: 50;
      background: var(--bg-glass); border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-md);
      padding: 14px 16px; animation: slideUpFade .7s var(--ease);
    }

    .logo img {
      animation: logoFloat 3s ease-in-out infinite, logoGlow 3s ease-in-out infinite;
    }

    .header-top { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .logo { display: flex; align-items: center; gap: 10px; font-weight: 900; font-size: 20px; cursor: pointer; user-select: none; }
    .logo span { width: 40px; height: 40px; border-radius: 14px; display: grid; place-items: center; background: var(--gradient-primary); color: #fff; box-shadow: 0 10px 25px rgba(255,71,87,.25); }
    
    .header-actions { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: flex-end; }
    .pill { display: inline-flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 999px; background: var(--bg-input); border: 1px solid rgba(0,0,0,.05); color: var(--text-main); box-shadow: var(--shadow-sm); transition: .25s; }
    [data-theme="dark"] .pill { border-color: rgba(255,255,255,.06); }
    .pill:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

    .icon-btn { width: 44px; height: 44px; border-radius: 50%; border: none; cursor: pointer; background: var(--bg-input); box-shadow: var(--shadow-sm); transition: transform .25s var(--ease-elastic); }
    .icon-btn:hover { transform: rotate(8deg) scale(1.08); }
    .theme-toggle::after { content: "üåô"; font-size: 18px; }
    [data-theme="dark"] .theme-toggle::after { content: "‚òÄÔ∏è"; }
    .lang-toggle::after { content: "KZ"; font-weight: 900; }
    [data-lang="kz"] .lang-toggle::after { content: "RU"; }

    nav { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; justify-content: center; }
    .nav-btn { position: relative; border: none; cursor: pointer; padding: 10px 14px; border-radius: 999px; background: transparent; color: var(--text-sub); font-weight: 700; transition: .25s; }
    .nav-btn:hover { background: rgba(255,71,87,.08); color: var(--primary); transform: translateY(-2px); }
    .nav-btn.active { background: var(--text-main); color: var(--bg-card); box-shadow: 0 10px 20px rgba(0,0,0,.10); }
    [data-theme="dark"] .nav-btn.active { background: #fff; color: #000; }
    .badge { position: absolute; top: -6px; right: -4px; width: 18px; height: 18px; border-radius: 50%; display: grid; place-items: center; background: var(--primary); color: #fff; font-size: 11px; font-weight: 900; border: 2px solid var(--bg-card); animation: popIn .4s var(--ease-elastic); }

    .main { display: grid; grid-template-columns: 320px 1fr 320px; gap: 16px; align-items: start; flex: 1; }
    .card { background: var(--bg-glass); border: 1px solid rgba(255,255,255,.10); backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); padding: 16px; animation: slideUpFade .6s var(--ease); }
    .card-title { font-size: 12px; text-transform: uppercase; letter-spacing: .14em; font-weight: 900; color: var(--text-sub); margin-bottom: 12px; }
    .stat-grid { display: grid; gap: 10px; }
    .stat { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 12px; border-radius: var(--radius-md); background: var(--bg-card); border: 1px solid rgba(0,0,0,.05); transition: .25s; }
    [data-theme="dark"] .stat { border-color: rgba(255,255,255,.06); }
    .stat:hover { transform: translateX(4px); }
    .stat span:first-child { color: var(--text-sub); font-weight: 700; font-size: 13px; }
    .stat span:last-child { font-weight: 900; }

    .section { display: none; }
    .section.active { display: block; animation: slideUpFade .5s var(--ease); }

    .browse-toolbar { display: flex; gap: 10px; margin-bottom: 12px; }
    .input { width: 100%; padding: 12px 14px; border-radius: var(--radius-md); border: 1px solid rgba(0,0,0,.08); background: var(--bg-card); color: var(--text-main); outline: none; transition: .2s; font-family: inherit; }
    [data-theme="dark"] .input { border-color: rgba(255,255,255,.08); }
    .input:focus { border-color: rgba(255,71,87,.45); box-shadow: 0 0 0 4px rgba(255,71,87,.15); }

    .btn { border: none; cursor: pointer; border-radius: var(--radius-md); padding: 12px 16px; font-weight: 900; transition: transform .2s var(--ease-elastic), filter .2s; }
    .btn:active { transform: scale(.97); }
    .btn-primary { background: var(--text-main); color: var(--bg-card); }
    .btn-primary:hover { filter: brightness(1.05); transform: translateY(-2px); }
    .btn-ghost { background: rgba(255,71,87,.10); color: var(--primary); }
    .btn-ghost:hover { transform: translateY(-2px); filter: brightness(1.02); }

    .profile-card { background: var(--bg-card); border-radius: var(--radius-xl); box-shadow: var(--shadow-lg); overflow: hidden; height: min(72vh, 680px); position: relative; }
    .photo { height: 100%; background: #eee; position: relative; overflow: hidden; display: grid; place-items: center; transition: filter .3s; background-size: cover; background-position: center; }
    .photo::after { content: ""; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,.85), rgba(0,0,0,.15), transparent); pointer-events: none; }
    .photo-emoji { font-size: 110px; z-index: 2; filter: drop-shadow(0 10px 30px rgba(0,0,0,.25)); transform: translateY(-10px); }
    .photo-nav { position: absolute; inset: 0; display: flex; z-index: 4; }
    .photo-nav button { flex: 1; border: none; background: transparent; cursor: pointer; color: transparent; }
    .photo-dots { position: absolute; top: 12px; left: 50%; transform: translateX(-50%); width: 92%; display: flex; gap: 6px; z-index: 5; }
    .dot { height: 4px; flex: 1; border-radius: 99px; background: rgba(255,255,255,.25); transition: .2s; }
    .dot.active { background: rgba(255,255,255,.92); transform: scaleY(1.6); }

    .badge-top { position: absolute; z-index: 6; top: 14px; padding: 7px 12px; border-radius: 999px; font-weight: 900; font-size: 12px; backdrop-filter: blur(10px); color: #fff; box-shadow: 0 10px 25px rgba(0,0,0,.15); }
    .badge-ai { right: 14px; background: rgba(46, 213, 115, .92); }
    .badge-verified { left: 14px; background: rgba(55,66,250,.92); }
    .badge-online { left: 14px; top: 54px; background: rgba(46, 213, 115, .92); }

    .profile-info { position: absolute; left: 0; bottom: 0; width: 100%; padding: 22px 22px 110px 22px; color: #fff; z-index: 6; }
    .p-name { font-size: 30px; font-weight: 900; margin: 0 0 4px; }
    .p-meta { font-weight: 800; opacity: .92; margin-bottom: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
    .p-bio { opacity: .9; margin: 0 0 12px; line-height: 1.5; max-width: 95%; }
    .tags { display: flex; gap: 8px; flex-wrap: wrap; }
    .tag { border: 1px solid rgba(255,255,255,.28); background: rgba(255,255,255,.16); padding: 6px 12px; border-radius: 999px; font-weight: 800; font-size: 13px; transition: .2s; }
    
    .actions { position: absolute; left: 50%; bottom: 16px; transform: translateX(-50%); display: flex; align-items: center; justify-content: center; gap: 14px; width: 100%; z-index: 8; pointer-events: auto; }
    .fab { width: 54px; height: 54px; border-radius: 50%; border: none; cursor: pointer; display: grid; place-items: center; font-size: 22px; box-shadow: 0 14px 28px rgba(0,0,0,.18); transition: transform .25s var(--ease-elastic); }
    .fab:hover { transform: translateY(-6px) scale(1.08); }
    .fab-like { width: 74px; height: 74px; background: var(--gradient-primary); color: #fff; animation: pulseGlow 2.2s infinite; }
    .fab-skip { background: #fff; color: #3b4356; }
    .fab-super { background: #fff; color: var(--warning); }
    .fab-gift { background: #fff; color: var(--secondary); }

    .match { background: var(--bg-card); border-radius: var(--radius-md); padding: 12px; border: 1px solid rgba(0,0,0,.05); display: flex; align-items: center; gap: 12px; cursor: pointer; transition: .25s; margin-bottom: 10px;}
    [data-theme="dark"] .match { border-color: rgba(255,255,255,.06); }
    .match:hover { transform: translateY(-3px) scale(1.01); box-shadow: var(--shadow-md); }
    .avatar { width: 56px; height: 56px; border-radius: 50%; display: grid; place-items: center; font-size: 24px; background: #eee; flex: 0 0 auto; background-size: cover; background-position: center; position: relative; }
    
    /* NEW: Online Status Dot */
    .online-dot {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 14px;
      height: 14px;
      background: #2ed573;
      border: 2px solid var(--bg-card);
      border-radius: 50%;
      z-index: 2;
    }

    .match-info { flex: 1; min-width: 0; }
    .match-name { font-weight: 900; margin: 0; }
    .match-sub { color: var(--text-sub); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .compat { font-weight: 900; font-size: 12px; padding: 6px 10px; border-radius: 999px; background: rgba(46,213,115,.12); color: var(--accent); border: 1px solid rgba(46,213,115,.25); }

    .gifts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
    .gift { background: var(--bg-card); border: 1px solid rgba(0,0,0,.05); border-radius: var(--radius-lg); padding: 16px; text-align: center; cursor: pointer; transition: .25s; }
    [data-theme="dark"] .gift { border-color: rgba(255,255,255,.06); }
    .gift:hover { transform: translateY(-8px); box-shadow: var(--shadow-md); border-color: rgba(255,71,87,.35); }
    .gift-emoji { font-size: 46px; display: block; margin-bottom: 8px; transition: transform .25s var(--ease-elastic); }
    .gift:hover .gift-emoji { transform: rotate(10deg) scale(1.12); }
    .gift-name { font-weight: 900; margin: 0 0 4px; }
    .gift-cost { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; font-weight: 900; font-size: 12px; background: rgba(255,165,2,.12); color: var(--warning); border: 1px solid rgba(255,165,2,.25); }

    .profile-box { max-width: 720px; margin: 0 auto; background: var(--bg-glass); border: 1px solid rgba(255,255,255,.10); border-radius: var(--radius-xl); padding: 18px; box-shadow: var(--shadow-md); backdrop-filter: var(--backdrop); -webkit-backdrop-filter: var(--backdrop); }
    .profile-hero { display: grid; gap: 14px; place-items: center; padding: 16px 10px; text-align: center; }
    .big-avatar { width: 120px; height: 120px; border-radius: 50%; background: var(--gradient-primary); color: #fff; display: grid; place-items: center; font-size: 56px; background-size: cover; background-position: center; position: relative; }
    .photo-upload-box { width: 100%; height: 120px; border: 2px dashed rgba(0,0,0,0.15); border-radius: var(--radius-md); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: .2s; color: var(--text-sub); background: rgba(0,0,0,0.02); margin-bottom: 8px; overflow: hidden; position: relative; }
    [data-theme="dark"] .photo-upload-box { border-color: rgba(255,255,255,0.15); background: rgba(255,255,255,0.02); }
    .photo-upload-box:hover { border-color: var(--primary); color: var(--primary); background: rgba(255,71,87,0.05); }
    .photo-upload-preview { position: absolute; inset: 0; background-size: cover; background-position: center; }
    .interests-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 6px; }
    .interest-tag { padding: 8px 14px; border-radius: 999px; background: var(--bg-input); border: 1px solid rgba(0,0,0,.08); font-size: 13px; font-weight: 700; cursor: pointer; transition: .2s; user-select: none; }
    [data-theme="dark"] .interest-tag { border-color: rgba(255,255,255,.1); }
    .interest-tag:hover { transform: translateY(-2px); }
    .interest-tag.selected { background: var(--text-main); color: var(--bg-card); border-color: var(--text-main); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    .form { display: grid; gap: 12px; text-align: left; margin-top: 10px; }
    .field { display: grid; gap: 6px; }
    .label { font-weight: 900; font-size: 13px; color: var(--text-sub); }
    .mini-list { display: grid; gap: 10px; }
    .mini { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: var(--radius-md); background: var(--bg-card); border: 1px solid rgba(0,0,0,.05); transition: .25s; cursor: pointer; }
    [data-theme="dark"] .mini { border-color: rgba(255,255,255,.06); }
    .mini:hover { transform: translateX(4px); }
    .mini .avatar { width: 44px; height: 44px; font-size: 20px; }

    .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; padding: 18px; background: rgba(0,0,0,.62); backdrop-filter: blur(10px); z-index: 1000; }
    .modal.active { display: flex; }
    .modal-content { width: 100%; max-width: 560px; max-height: 88vh; overflow: auto; background: var(--bg-card); border-radius: var(--radius-xl); box-shadow: var(--shadow-lg); border: 1px solid rgba(0,0,0,.06); animation: popIn .35s var(--ease-elastic); position: relative; }
    .modal-head { padding: 16px 16px 0 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .modal-close { width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; background: rgba(0,0,0,.08); transition: .2s; }
    .modal-close:hover { transform: rotate(90deg); background: var(--primary); color: #fff; }
    .modal-body { padding: 16px; }

    .chat { height: 520px; display: flex; flex-direction: column; gap: 12px; }
    .chat-log { flex: 1; overflow: auto; background: var(--bg-input); border-radius: var(--radius-lg); padding: 12px; display: flex; flex-direction: column; gap: 10px; border: 1px solid rgba(0,0,0,.06); }
    [data-theme="dark"] .chat-log { border-color: rgba(255,255,255,.06); }
    .msg { max-width: 78%; padding: 10px 12px; border-radius: 18px; font-size: 14px; line-height: 1.4; animation: slideUpFade .25s var(--ease); }
    .msg.me { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 6px; }
    .msg.other { align-self: flex-start; background: var(--bg-card); color: var(--text-main); border-bottom-left-radius: 6px; box-shadow: var(--shadow-sm); }
    .chat-input { display: flex; gap: 10px; align-items: center; }
    .send { width: 46px; height: 46px; border-radius: 50%; border: none; cursor: pointer; background: var(--primary); color: #fff; font-size: 18px; transition: transform .2s var(--ease-elastic); }
    .send:hover { transform: rotate(-12deg) scale(1.06); }

    .toast { position: fixed; left: 50%; top: 18px; transform: translateX(-50%) translateY(-120px); background: var(--text-main); color: var(--bg-card); border-radius: 999px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; box-shadow: 0 18px 60px rgba(0,0,0,.22); z-index: 2000; transition: transform .35s var(--ease-elastic); font-weight: 800; max-width: min(92vw, 720px); }
    .toast.show { transform: translateX(-50%) translateY(0); }
    .rt-bell { position: fixed; right: 16px; bottom: 16px; z-index: 2100; display: grid; gap: 10px; justify-items: end; pointer-events: none; }
    .rt-card { pointer-events: auto; width: min(360px, 92vw); background: var(--bg-card); border: 1px solid rgba(0,0,0,.06); border-radius: 18px; box-shadow: var(--shadow-lg); padding: 12px; display: grid; gap: 8px; animation: popIn .35s var(--ease-elastic); }
    .rt-top { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .rt-title { font-weight: 900; }
    .rt-sub { font-size: 13px; color: var(--text-sub); }
    .rt-actions { display: flex; gap: 10px; }

    @media (max-width: 1080px) { .main { grid-template-columns: 320px 1fr; } .right { display: none; } }
    @media (max-width: 820px) {
      header { top: 0; border-radius: 0 0 var(--radius-lg) var(--radius-lg); }
      .container { padding: 0; }
      .main { grid-template-columns: 1fr; padding: 12px; }
      .left { order: 2; } .center { order: 1; } .right { display: none; }
      .profile-card { height: 66vh; }
      nav { gap: 6px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="header-top">
        <div class="logo" onclick="showSection('browse')" title="EvilCorp">
          <span style="overflow: hidden; display: flex; align-items: center; justify-content: center;">
            <img src="https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/a7bf33ed9e543381474d76dbe99208099c7a9dfd/image.png" alt="Logo" width="45" height="45">
          </span>
          <div>
            <div style="font-size:18px; line-height:1;">Evil<b>Corp</b></div>
            <div style="font-size:12px; font-weight:800; color:var(--text-sub);">New features ‚Ä¢ Smart Chat</div>
          </div>
        </div>

        <div class="header-actions">
          <div class="pill">‚≠ê <span id="starBalance">0</span></div>
          <div class="pill">üíò <span id="matchCount">0</span></div>
          <button class="icon-btn theme-toggle" onclick="toggleTheme()"></button>
          <button class="icon-btn lang-toggle" onclick="toggleLang()"></button>
        </div>
      </div>

      <nav>
        <button class="nav-btn active" data-section="browse" onclick="showSection('browse')">üîç <span data-i18n="nav_search">–Ü–∑–¥–µ—É</span></button>
        <button class="nav-btn" data-section="matches" onclick="showSection('matches')">
          üí¨ <span data-i18n="nav_chats">–ß–∞—Ç—Ç–∞—Ä</span>
          <span class="badge" id="unreadBadge" style="display:none;">0</span>
        </button>
        <button class="nav-btn" data-section="gifts" onclick="showSection('gifts')">üéÅ <span data-i18n="nav_gifts">–°—ã–π–ª—ã“õ—Ç–∞—Ä</span></button>
        <button class="nav-btn" data-section="profile" onclick="showSection('profile')">üë§ <span data-i18n="nav_profile">–ü—Ä–æ—Ñ–∏–ª—å</span></button>
      </nav>
    </header>

    <div class="main">
      <aside class="card left">
        <div class="card-title" data-i18n="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="stat-grid">
          <div class="stat"><span data-i18n="views">–ö”©—Ä—É–ª–µ—Ä</span><span id="views">0</span></div>
          <div class="stat"><span data-i18n="likes">“∞–Ω–∞—Ç“õ–∞–Ω–¥–∞—Ä</span><span id="likes">0</span></div>
          <div class="stat"><span data-i18n="ai">AI Score</span><span id="aiScoreSmall" style="color:var(--accent)">--</span></div>
          <div class="stat"><span data-i18n="verified">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span><span id="verifiedSmall">‚Äî</span></div>
        </div>
        <div style="height:14px"></div>
        <button class="btn btn-ghost" onclick="simulateRealtimeMatch()" style="width:100%;">
          ‚ö° <span data-i18n="simulate">–°–∏–º—É–ª—è—Ü–∏—è –º–∞—Ç—á–∞</span>
        </button>
      </aside>

      <main class="center">
        <section class="section active" id="browse">
          <div class="browse-toolbar">
            <select class="input" id="citySelect">
              <option value="" data-i18n="all_cities">–ë–∞—Ä–ª—ã“õ “õ–∞–ª–∞–ª–∞—Ä</option>
              <option value="–ê–ª–º–∞—Ç—ã">–ê–ª–º–∞—Ç—ã</option>
              <option value="–ê—Å—Ç–∞–Ω–∞">–ê—Å—Ç–∞–Ω–∞</option>
              <option value="–®—ã–º–∫–µ–Ω—Ç">–®—ã–º–∫–µ–Ω—Ç</option>
              <option value="–ö–∞—Ä–∞–≥–∞–Ω–¥—ã">–ö–∞—Ä–∞–≥–∞–Ω–¥—ã</option>
              <option value="–ê—Ç—ã—Ä–∞—É">–ê—Ç—ã—Ä–∞—É</option>
              <option value="–ê“õ—Ç–∞—É">–ê“õ—Ç–∞—É</option>
            </select>
            <button class="btn btn-primary" onclick="filterByCity()">Go</button>
          </div>

          <div class="profile-card" id="profileCard">
            <div class="photo" id="photo">
              <div class="photo-dots" id="photoDots"></div>
              <div class="badge-top badge-ai">ü§ñ <span id="aiScore">--</span>%</div>
              <div class="badge-top badge-verified" id="verifiedBadge" style="display:none;">‚úì Verified</div>
              <div class="badge-top badge-online" id="onlineBadge" style="display:none;">‚óè Online</div>
              <div class="photo-emoji" id="photoEmoji">üë§</div>

              <div class="photo-nav">
                <button onclick="prevPhoto()"></button>
                <button onclick="nextPhoto()"></button>
              </div>

              <div class="profile-info">
                <h2 class="p-name" id="pName">Loading‚Ä¶</h2>
                <div class="p-meta" id="pMeta">‚Ä¶</div>
                <p class="p-bio" id="pBio">‚Ä¶</p>
                <div class="tags" id="pTags"></div>
              </div>

              <div class="actions">
                <button class="fab fab-skip" onclick="skip()">‚úï</button>
                <button class="fab fab-super" onclick="superLike()">‚≠ê</button>
                <button class="fab fab-like" onclick="like()">‚ù§Ô∏è</button>
                <button class="fab fab-gift" onclick="openGiftModal()">üéÅ</button>
              </div>
            </div>
          </div>
        </section>

        <section class="section" id="matches">
          <div class="card" style="background:transparent; border:none; box-shadow:none; padding:0;">
            <div class="card-title" style="font-size:14px;" data-i18n="your_matches">–í–∞—à–∏ –º–∞—Ç—á–∏</div>
            <div class="list" id="matchesList"></div>
          </div>
        </section>

        <section class="section" id="gifts">
          <div class="card" style="background:transparent; border:none; box-shadow:none; padding:0;">
            <div class="card-title" style="font-size:14px;" data-i18n="gift_shop">–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤</div>
            <div class="gifts-grid" id="giftsGrid"></div>
          </div>
        </section>

        <section class="section" id="profile">
          <div class="profile-box">
            <div class="profile-hero">
              <div class="big-avatar" id="meAvatar">üë§</div>
              <div>
                <div style="font-weight:900; font-size:18px;" id="meName">User</div>
                <div style="color:var(--text-sub); font-weight:800;" id="meCity">‚Äî</div>
              </div>
            </div>

            <form class="form" id="profileForm" novalidate>
              <div class="field">
                <div class="label" data-i18n="upload_photo">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
                <label class="photo-upload-box">
                  <span style="font-size:24px; margin-bottom:4px;">üì∑</span>
                  <span style="font-size:12px; font-weight:700;" data-i18n="photo_hint">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</span>
                  <input type="file" id="inpFile" accept="image/*" hidden onchange="handleFileSelect(event)">
                  <div class="photo-upload-preview" id="photoPreview" style="display:none;"></div>
                </label>
              </div>

              <div class="field">
                <div class="label" data-i18n="your_name">–í–∞—à–µ –∏–º—è</div>
                <input class="input" id="inpName" type="text" placeholder="Aruzhan" required minlength="2" />
              </div>
              <div class="field">
                <div class="label" data-i18n="your_city">–í–∞—à –≥–æ—Ä–æ–¥</div>
                <select class="input" id="inpCity" required>
                  <option value="" data-i18n="choose_city">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                  <option value="–ê–ª–º–∞—Ç—ã">–ê–ª–º–∞—Ç—ã</option>
                  <option value="–ê—Å—Ç–∞–Ω–∞">–ê—Å—Ç–∞–Ω–∞</option>
                  <option value="–®—ã–º–∫–µ–Ω—Ç">–®—ã–º–∫–µ–Ω—Ç</option>
                </select>
              </div>
              <div class="field">
                <div class="label" data-i18n="interests_label">–ò–Ω—Ç–µ—Ä–µ—Å—ã</div>
                <div class="interests-grid" id="interestContainer"></div>
              </div>
              
              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                <button class="btn btn-primary" type="submit">üíæ <span data-i18n="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span></button>
                <button class="btn btn-ghost" type="button" onclick="verifyProfile()">üì∏ <span data-i18n="verify">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span></button>
              </div>
            </form>
          </div>
        </section>
      </main>

      <aside class="card right">
        <div class="card-title" data-i18n="online">–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å</div>
        <div class="mini-list" id="onlineList"></div>
      </aside>
    </div>
  </div>

  <div class="modal" id="giftModal" onclick="modalBackdropClose(event, 'giftModal')">
    <div class="modal-content">
      <div class="modal-head">
        <div style="font-weight:900;" data-i18n="choose_gift">üéÅ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</div>
        <button class="modal-close" onclick="closeModal('giftModal')">‚úï</button>
      </div>
      <div class="modal-body"><div class="gifts-grid" id="giftModalGrid"></div></div>
    </div>
  </div>

  <div class="modal" id="chatModal" onclick="modalBackdropClose(event, 'chatModal')">
    <div class="modal-content">
      <div class="modal-head">
        <div>
          <div style="font-weight:900;" id="chatTitle">üí¨ –ß–∞—Ç</div>
          <div style="font-size:12px; color:var(--text-sub); font-weight:800;" id="chatSubtitle">‚Äî</div>
        </div>
        <button class="modal-close" onclick="closeModal('chatModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="chat">
          <div class="chat-log" id="chatLog"></div>
          <div class="chat-input">
            <input class="input" id="chatInput" type="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" />
            <button class="send" onclick="sendMessage()">‚û§</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <span id="toastIcon">‚ú®</span>
    <span id="toastText">‚Äî</span>
  </div>

  <div class="rt-bell" id="rtBell"></div>

  <script>
    // ==========================================================
    // JS LOGIC
    // ==========================================================

    const i18n = {
      ru: {
        nav_search: '–ü–æ–∏—Å–∫', nav_chats: '–ß–∞—Ç—ã', nav_gifts: '–ü–æ–¥–∞—Ä–∫–∏', nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', views: '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã', likes: '–õ–∞–π–∫–∏', ai: 'AI Score', verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time', simulate: '–°–∏–º—É–ª—è—Ü–∏—è –º–∞—Ç—á–∞', all_cities: '–í—Å–µ –≥–æ—Ä–æ–¥–∞',
        your_matches: '–í–∞—à–∏ –º–∞—Ç—á–∏', gift_shop: '–ú–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤', online: '–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å',
        your_name: '–í–∞—à–µ –∏–º—è', your_city: '–í–∞—à –≥–æ—Ä–æ–¥', choose_city: '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥',
        interests_label: '–ò–Ω—Ç–µ—Ä–µ—Å—ã', upload_photo: '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ', photo_hint: '–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞',
        save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', verify: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è', choose_gift: '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω', toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω ‚úì',
        toast_like: '–õ–∞–π–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚ù§Ô∏è', toast_skip: '–ü—Ä–æ–ø—É—Å–∫', toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω üéÅ', toast_match: '–ù–æ–≤—ã–π –º–∞—Ç—á! üíò',
        chat_placeholder: '–°–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶', rt_new_match: '–ù–æ–≤—ã–π –º–∞—Ç—á', rt_open_chat: '–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç', rt_close: '–ó–∞–∫—Ä—ã—Ç—å',
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞', cat_sport: 'üèÄ –°–ø–æ—Ä—Ç', cat_travel: '‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è', cat_gaming: 'üéÆ –ì–µ–π–º–∏–Ω–≥',
        cat_art: 'üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ', cat_cooking: 'üç≥ –ì–æ—Ç–æ–≤–∫–∞', cat_movies: 'üé¨ –ö–∏–Ω–æ', cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', cat_nature: 'üçÉ –ü—Ä–∏—Ä–æ–¥–∞'
      },
      kz: {
        nav_search: '–Ü–∑–¥–µ—É', nav_chats: '–ß–∞—Ç—Ç–∞—Ä', nav_gifts: '–°—ã–π–ª—ã“õ—Ç–∞—Ä', nav_profile: '–ü—Ä–æ—Ñ–∏–ª—å',
        stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', views: '–ö”©—Ä—É–ª–µ—Ä', likes: '“∞–Ω–∞—Ç“õ–∞–Ω–¥–∞—Ä', ai: 'AI Score', verified: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è',
        realtime: 'Real-time', simulate: '–ú–∞—Ç—á —Å–∏–º—É–ª—è—Ü–∏—è—Å—ã', all_cities: '–ë–∞—Ä–ª—ã“õ “õ–∞–ª–∞–ª–∞—Ä',
        your_matches: '–°—ñ–∑–¥—ñ“£ –º–∞—Ç—á—Ç–∞—Ä', gift_shop: '–°—ã–π–ª—ã“õ –¥“Ø–∫–µ–Ω—ñ', online: '“ö–∞–∑—ñ—Ä –æ–Ω–ª–∞–π–Ω',
        your_name: '–ê—Ç—ã“£—ã–∑', your_city: '“ö–∞–ª–∞“£—ã–∑', choose_city: '“ö–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑',
        interests_label: '“ö—ã–∑—ã“ì—É—à—ã–ª—ã“õ—Ç–∞—Ä', upload_photo: '–§–æ—Ç–æ –∂“Ø–∫—Ç–µ—É', photo_hint: '–¢–∞“£–¥–∞—É “Ø—à—ñ–Ω –±–∞—Å—ã“£—ã–∑',
        save: '–°–∞“õ—Ç–∞—É', verify: '–ü—Ä–æ—Ñ–∏–ª—å–¥—ñ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–ª–∞—É', choose_gift: '–°—ã–π–ª—ã“õ —Ç–∞“£–¥–∞“£—ã–∑',
        toast_saved: '–ü—Ä–æ—Ñ–∏–ª—å —Å–∞“õ—Ç–∞–ª–¥—ã', toast_verified: '–ü—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è–¥–∞–Ω ”©—Ç—Ç—ñ ‚úì',
        toast_like: '–õ–∞–π–∫ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ ‚ù§Ô∏è', toast_skip: '”®—Ç–∫—ñ–∑—É', toast_super: '–°—É–ø–µ—Ä–ª–∞–π–∫ ‚≠ê',
        toast_gift: '–°—ã–π–ª—ã“õ –∂—ñ–±–µ—Ä—ñ–ª–¥—ñ üéÅ', toast_match: '–ñ–∞“£–∞ –º–∞—Ç—á! üíò',
        chat_placeholder: '–•–∞–±–∞—Ä–ª–∞–º–∞‚Ä¶', rt_new_match: '–ñ–∞“£–∞ –º–∞—Ç—á', rt_open_chat: '–ß–∞—Ç—Ç—ã –∞—à—É', rt_close: '–ñ–∞–±—É',
        cat_music: 'üéµ –ú—É–∑—ã–∫–∞', cat_sport: 'üèÄ –°–ø–æ—Ä—Ç', cat_travel: '‚úàÔ∏è –°–∞—è—Ö–∞—Ç', cat_gaming: 'üéÆ –û–π—ã–Ω–¥–∞—Ä',
        cat_art: 'üé® ”®–Ω–µ—Ä', cat_cooking: 'üç≥ –ê—Å–ø–∞–∑–¥—ã“õ', cat_movies: 'üé¨ –ö–∏–Ω–æ', cat_tech: 'üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è', cat_nature: 'üçÉ –¢–∞–±–∏“ì–∞—Ç'
      }
    };

    const photoGradients = [
      'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
      'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
      'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)'
    ];

    const profileDatabase = [
      { 
        id: 101, 
        name: '–¢—É—Ä–∞—à –ê–ª–∏', 
        age: 23, 
        city: '–ê–ª–º–∞—Ç—ã', 
        emoji: 'ü¶Å', 
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/image%20(2).png', 
        bio: 'üí° AI-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –≤–∞—à–∏–º –æ–±—â–∏–º –∏–Ω—Ç–µ—Ä–µ—Å–∞–º! –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ. üòé', 
        interests: ['üèÄ –°–ø–æ—Ä—Ç', '‚úàÔ∏è –°–∞—è—Ö–∞—Ç', 'üíº –ë–∏–∑–Ω–µ—Å'], 
        verified: true, 
        online: true, 
        aiScore: 98, 
        photos: [0] 
      },
      { 
        id: 102, 
        name: '–ú–∏—Ä–∞—Å –ù—É—Ä–∫–∞—Å—ã–º', 
        age: 24, 
        city: '–ê—Å—Ç–∞–Ω–∞', 
        emoji: 'üòé',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132795_x.png', 
        bio: '–õ—é–±–ª—é IT, —Å—Ç–∞—Ä—Ç–∞–ø—ã –∏ –≤–∫—É—Å–Ω—ã–π –∫–æ—Ñ–µ. –ò—â—É —Ç—É —Å–∞–º—É—é.', 
        interests: ['üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', '‚òï –ö–æ—Ñ–µ', 'üéÆ –ì–µ–π–º–∏–Ω–≥'], 
        verified: true, 
        online: false, 
        aiScore: 95, 
        photos: [1] 
      },
      { 
        id: 103, 
        name: '–û—Ä–∞–∑–±–∞–∫–æ–≤ –¢–µ–º–∏—Ä–ª–∞–Ω', 
        age: 22, 
        city: '–ê–ª–º–∞—Ç—ã', 
        emoji: 'üî•',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5440511241249473687_c.png', 
        bio: '–í—Å–µ–≥–¥–∞ –Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–µ. –õ—é–±–ª—é –≥–æ—Ä—ã –∏ –∞–∫—Ç–∏–≤–Ω—ã–π –æ—Ç–¥—ã—Ö üèîÔ∏è', 
        interests: ['üèîÔ∏è –ì–æ—Ä—ã', 'üéµ –ú—É–∑—ã–∫–∞', 'üöó –ê–≤—Ç–æ'], 
        verified: true, 
        online: true, 
        aiScore: 92, 
        photos: [2] 
      },
      { 
        id: 104, 
        name: '–ö–∞–∑–±–µ–∫–æ–≤–∞ –ê–π–≥–µ—Ä–∏–º', 
        age: 21, 
        city: '–ê–ª–º–∞—Ç—ã', 
        emoji: 'üå∏',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132809_x.png', 
        bio: '–ù–µ–∂–Ω–∞—è, –Ω–æ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º. –õ—é–±–ª—é –∏—Å–∫—É—Å—Å—Ç–≤–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚ú®', 
        interests: ['üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ', 'üëó –ú–æ–¥–∞', 'üìö –ö–Ω–∏–≥–∏'], 
        verified: true, 
        online: true, 
        aiScore: 99, 
        photos: [3] 
      },
      { 
        id: 105, 
        name: '–ñ–∞–Ω–∏—è', 
        age: 20, 
        city: '–®—ã–º–∫–µ–Ω—Ç', 
        emoji: 'üíÉ',
        image: 'https://raw.githubusercontent.com/dreamnewly/dating-bot-photos-demo/main/photo_5192685967507132803_m.png', 
        bio: '–£–ª—ã–±–∞–π—Å—è, —Ç–µ–±–µ —ç—Ç–æ –∏–¥–µ—Ç! –õ—é–±–ª—é —Ç–∞–Ω—Ü—ã –∏ –ª–µ—Ç–æ ‚òÄÔ∏è', 
        interests: ['üíÉ –¢–∞–Ω—Ü—ã', 'üé¨ –ö–∏–Ω–æ', 'üç≥ –ì–æ—Ç–æ–≤–∫–∞'], 
        verified: false, 
        online: true, 
        aiScore: 89, 
        photos: [4] 
      }
    ];

    const gifts = [
      { nameKz: '–†–∞—É—à–∞–Ω', nameRu: '–†–æ–∑–∞', emoji: 'üåπ', cost: 10 },
      { nameKz: '–®–æ–∫–æ–ª–∞–¥', nameRu: '–®–æ–∫–æ–ª–∞–¥', emoji: 'üç´', cost: 15 },
      { nameKz: '–¢”ô–∂', nameRu: '–ö–æ—Ä–æ–Ω–∞', emoji: 'üëë', cost: 50 },
      { nameKz: '–ì–∞—É“ª–∞—Ä', nameRu: '–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç', emoji: 'üíé', cost: 100 },
      { nameKz: '–ö–æ—Ñ–µ', nameRu: '–ö–æ—Ñ–µ', emoji: '‚òï', cost: 5 },
      { nameKz: '–†–∞–∫–µ—Ç–∞', nameRu: '–†–∞–∫–µ—Ç–∞', emoji: 'üöÄ', cost: 200 }
    ];

    const interestCategories = ['cat_music', 'cat_sport', 'cat_travel', 'cat_gaming', 'cat_art', 'cat_cooking', 'cat_movies', 'cat_tech', 'cat_nature'];

    let allProfiles = [...profileDatabase];
    let filteredProfiles = [...allProfiles];
    let idx = 0;
    let photoIdx = 0;
    let starBalance = 1000;
    let views = 0;
    let likes = 0;
    let matches = [];
    let chats = {}; 
    let isVerified = false;
    let giftTarget = null;
    let currentChatId = null;
    let unreadCount = 0;
    let lang = 'kz';
    let myInterests = [];
    let myPhoto = null;

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    function save() {
      localStorage.setItem('dhp_starBalance', String(starBalance));
      localStorage.setItem('dhp_views', String(views));
      localStorage.setItem('dhp_likes', String(likes));
      localStorage.setItem('dhp_matches', JSON.stringify(matches));
      localStorage.setItem('dhp_chats', JSON.stringify(chats));
      localStorage.setItem('dhp_verified', String(isVerified));
      localStorage.setItem('dhp_lang', String(lang));
    }

    function load() {
      starBalance = parseInt(localStorage.getItem('dhp_starBalance') || '100', 10);
      views = parseInt(localStorage.getItem('dhp_views') || '0', 10);
      likes = parseInt(localStorage.getItem('dhp_likes') || '0', 10);
      matches = JSON.parse(localStorage.getItem('dhp_matches') || '[]');
      chats = JSON.parse(localStorage.getItem('dhp_chats') || '{}');
      isVerified = localStorage.getItem('dhp_verified') === 'true';
      lang = localStorage.getItem('dhp_lang') || 'kz';
    }

    function shuffle(arr) { for (let i = arr.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [arr[i], arr[j]] = [arr[j], arr[i]]; } return arr; }
    function t(key) { return i18n[lang]?.[key] ?? i18n.ru[key] ?? key; }
    function toast(icon, text, ms = 2200) { $('#toastIcon').textContent = icon; $('#toastText').textContent = text; const el = $('#toast'); el.classList.add('show'); clearTimeout(toast._t); toast._t = setTimeout(() => el.classList.remove('show'), ms); }

    function calculateCompatibility(profile) {
      if (!myInterests || myInterests.length === 0) return profile.aiScore || 75;
      const myInterestLabels = myInterests.map(cat => t(cat));
      let commonInterests = 0;
      profile.interests.forEach(interest => { if (myInterestLabels.includes(interest)) commonInterests++; });
      const maxInterests = Math.max(myInterests.length, profile.interests.length);
      if (maxInterests === 0) return profile.aiScore || 75;
      let compatibilityScore = Math.round((commonInterests / maxInterests) * 100);
      if (commonInterests > 0) compatibilityScore = Math.max(50, compatibilityScore);
      if (profile.verified) compatibilityScore = Math.min(100, compatibilityScore + 5);
      if (profile.online) compatibilityScore = Math.min(100, compatibilityScore + 3);
      return Math.max(30, Math.min(100, compatibilityScore));
    }

    function updateBadges() {
      $('#starBalance').textContent = starBalance; $('#matchCount').textContent = matches.length;
      $('#views').textContent = views; $('#likes').textContent = likes;
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';
      const badge = $('#unreadBadge');
      if (unreadCount > 0) { badge.style.display = ''; badge.textContent = String(unreadCount); } else { badge.style.display = 'none'; }
    }

    function applyI18n() {
      document.documentElement.setAttribute('data-lang', lang);
      $$('[data-i18n]').forEach(el => { const key = el.getAttribute('data-i18n'); el.textContent = t(key); });
      $('#chatInput').placeholder = t('chat_placeholder');
      renderInterests();
    }

    function toggleTheme() { const root = document.documentElement; const isDark = root.getAttribute('data-theme') === 'dark'; root.setAttribute('data-theme', isDark ? 'light' : 'dark'); localStorage.setItem('dhp_theme', isDark ? 'light' : 'dark'); }
    function toggleLang() { lang = (lang === 'kz') ? 'ru' : 'kz'; applyI18n(); renderGifts(); renderMatches(); save(); toast('üåê', lang === 'kz' ? '“ö–∞–∑–∞“õ—à–∞' : '–†—É—Å—Å–∫–∏–π'); }

    function showSection(id) { $$('.section').forEach(s => s.classList.remove('active')); $('#' + id).classList.add('active'); $$('.nav-btn').forEach(b => b.classList.toggle('active', b.dataset.section === id)); if (id === 'matches') { unreadCount = 0; updateBadges(); } }

    function currentProfile() { return filteredProfiles.length ? filteredProfiles[idx % filteredProfiles.length] : null; }
    function renderDots(count) { const wrap = $('#photoDots'); wrap.innerHTML = ''; for (let i = 0; i < count; i++) { const d = document.createElement('div'); d.className = 'dot' + (i === photoIdx ? ' active' : ''); wrap.appendChild(d); } }
    
    function displayProfile() {
      const p = currentProfile();
      if (!p) return;
      views++;
      const photoEl = $('#photo');
      const emojiEl = $('#photoEmoji');
      if (p.image && p.image.startsWith('http')) {
        const tempImg = new Image();
        tempImg.onload = function() {
          photoEl.style.background = `url("${p.image}") center/cover no-repeat`;
          emojiEl.style.display = 'none';
        };
        tempImg.onerror = function() {
          photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
          emojiEl.style.display = 'block';
          emojiEl.textContent = p.emoji;
        };
        tempImg.src = p.image;
        photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
        emojiEl.style.display = 'block';
        emojiEl.textContent = p.emoji;
      } else {
        photoEl.style.background = photoGradients[p.photos[photoIdx] ?? 0];
        emojiEl.style.display = 'block';
        emojiEl.textContent = p.emoji;
      }
      $('#pName').textContent = `${p.name}, ${p.age}`;
      $('#pMeta').innerHTML = `üìç ${p.city} ‚Ä¢ ${p.distance || 2}–∫–º`;
      $('#pBio').textContent = p.bio;
      const dynamicScore = calculateCompatibility(p);
      $('#aiScore').textContent = dynamicScore; 
      $('#aiScoreSmall').textContent = dynamicScore + '%';
      $('#verifiedBadge').style.display = p.verified ? '' : 'none';
      $('#onlineBadge').style.display = p.online ? '' : 'none';
      $('#pTags').innerHTML = '';
      p.interests.forEach(x => { const el = document.createElement('div'); el.className = 'tag'; el.textContent = x; $('#pTags').appendChild(el); });
      renderDots(p.photos.length); updateBadges(); save();
    }

    function nextPhoto() { const p = currentProfile(); if (!p) return; photoIdx = (photoIdx + 1) % p.photos.length; displayProfile(); }
    function prevPhoto() { const p = currentProfile(); if (!p) return; photoIdx = (photoIdx - 1 + p.photos.length) % p.photos.length; displayProfile(); }
    function skip() { toast('üëã', t('toast_skip')); idx++; photoIdx = 0; displayProfile(); }
    
    function superLike() {
      if (starBalance < 5) { toast('‚ö†Ô∏è', 'Not enough ‚≠ê'); return; }
      starBalance -= 5; likes++; toast('‚≠ê', t('toast_super'));
      tryMatch(true); idx++; photoIdx = 0; displayProfile();
    }
    function like() { likes++; toast('‚ù§Ô∏è', t('toast_like')); tryMatch(false); idx++; photoIdx = 0; displayProfile(); }
    function filterByCity() { const city = $('#citySelect').value; filteredProfiles = city ? allProfiles.filter(p => p.city === city) : [...allProfiles]; idx = 0; photoIdx = 0; displayProfile(); toast('üîé', city ? `City: ${city}` : t('all_cities')); }

    function tryMatch(isSuper) {
      const p = currentProfile(); if (!p) return;
      const chance = Math.min(0.92, (isSuper ? 0.72 : 0.38) + (p.aiScore / 250));
      if (Math.random() <= chance) createMatch(p);
    }

    function createMatch(profile) {
      if (matches.some(m => m.id === profile.id)) return;
      const match = { 
        id: profile.id, 
        name: profile.name, 
        emoji: profile.emoji, 
        image: profile.image, 
        city: profile.city, 
        aiScore: calculateCompatibility(profile), 
        ts: Date.now() 
      };
      matches.unshift(match);
      chats[String(match.id)] = chats[String(match.id)] || [{ me: false, text: '–°”ô–ª–µ–º! üëã', ts: Date.now() }];
      unreadCount++; updateBadges(); renderMatches(); save(); toast('üíò', t('toast_match')); pushRealtimeCard(match);
    }

    function pushRealtimeCard(match) {
      const bell = $('#rtBell');
      const card = document.createElement('div'); card.className = 'rt-card';
      card.innerHTML = `<div class="rt-top"><div><div class="rt-title">${t('rt_new_match')} üíò</div><div class="rt-sub">${match.emoji} ${match.name}</div></div><button class="icon-btn" style="width:40px;height:40px;" onclick="this.closest('.rt-card').remove()">‚úï</button></div><div class="rt-actions"><button class="btn btn-primary" style="flex:1" onclick="openChat(${match.id}); this.closest('.rt-card').remove();">üí¨ ${t('rt_open_chat')}</button></div>`;
      bell.appendChild(card); setTimeout(() => { if (card.isConnected) card.remove(); }, 9000);
    }
    function simulateRealtimeMatch() { const pool = allProfiles.filter(p => !matches.some(m => m.id === p.id)); if (!pool.length) return; createMatch(pool[Math.floor(Math.random() * pool.length)]); }

    function renderMatches() {
      const list = $('#matchesList'); list.innerHTML = '';
      if (!matches.length) { list.innerHTML = '<div style="padding:10px; opacity:0.6">–ù–µ—Ç –º–∞—Ç—á–µ–π</div>'; return; }
      matches.forEach(m => {
        const row = document.createElement('div'); row.className = 'match'; row.onclick = () => openChat(m.id);
        let avatarStyle = `background:${photoGradients[m.id % photoGradients.length]}`;
        let avatarContent = m.emoji;
        if (m.image && m.image.startsWith('http')) {
             avatarStyle = `background:url('${m.image}') center/cover no-repeat`;
             avatarContent = '';
        }
        const profile = allProfiles.find(p => p.id === m.id);
        const displayScore = profile ? calculateCompatibility(profile) : m.aiScore;
        row.innerHTML = `<div class="avatar" style="${avatarStyle}">${avatarContent}</div><div class="match-info"><p class="match-name">${m.name}</p><div class="match-sub">üìç ${m.city}</div></div><div class="compat">${displayScore}%</div>`;
        list.appendChild(row);
      });
    }

    function openChat(matchId) {
      const m = matches.find(x => x.id === matchId); if (!m) return;
      currentChatId = String(matchId);
      const profile = allProfiles.find(p => p.id === m.id);
      const displayScore = profile ? calculateCompatibility(profile) : m.aiScore;
      $('#chatTitle').textContent = `üí¨ ${m.name}`; $('#chatSubtitle').textContent = `${m.emoji} ${m.city} ‚Ä¢ ${displayScore}%`;
      renderChat(); openModal('chatModal'); unreadCount = Math.max(0, unreadCount - 1); updateBadges();
    }

    function renderChat() {
      const log = $('#chatLog'); log.innerHTML = '';
      const msgs = chats[currentChatId] || [];
      msgs.forEach(msg => { const el = document.createElement('div'); el.className = 'msg ' + (msg.me ? 'me' : 'other'); el.textContent = msg.text; log.appendChild(el); });
      log.scrollTop = log.scrollHeight;
    }

    const chatPatterns = {
  ru: [
    // --- –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø ---
    { keywords: ['–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', '–∫—É', '—Ö–µ–ª–ª–æ—É', '—Å–∞–ª–∞–º', '—Å–∞–ª–∞–º–∞–ª–µ–π–∫—É–º', '–∑–¥–∞—Ä–æ–≤–∞', '–π–æ'], answers: ['–ü—Ä–∏–≤–µ—Ç! üëã', '–°–∞–ª—é—Ç! –ö–∞–∫ –æ–Ω–æ?', '–û, –ø—Ä–∏–≤–µ—Ç :)', '–°–∞–ª–∞–º! –ö–∞–∫ –∂–∏–∑–Ω—å?', '–ö—É-–∫—É!', '–ü—Ä–∏–≤–µ—Ç, –∫—Ä–∞—à üòâ'] },
    
    // --- –ö–ê–ö –î–ï–õ–ê (–°–õ–ï–ù–ì + –û–ë–´–ß–ù–´–ï) ---
    { keywords: ['–∫–∞–∫ –¥–µ–ª–∞', '–∫–∞–∫ —Ç—ã', '—á–µ –∫–æ–≥–æ', '—á—Ç–æ –Ω–æ–≤–æ–≥–æ', '–∫–∞–∫ –∂–∏–∑–Ω—å', '—á–µ —Ç–∞–º', '—á–µ –∫–∞–≤–æ', '–∫–∞–ª–∞–π', '—Ç–∏—à–∏–Ω–∞'], answers: ['–í—Å–µ —Å—É–ø–µ—Ä! –ê —É —Ç–µ–±—è? üòä', '–ü–æ—Ç–∏—Ö–æ–Ω—å–∫—É, —Å–∞–º –∫–∞–∫?', '–í—Å–µ —Ä–æ–≤–Ω–æ, –¥–≤–∏–≥–∞—é—Å—å. –¢—ã –∫–∞–∫?', '–ù–æ—Ä–º–∞–ª—å–Ω–æ, –ø–æ–π–¥–µ—Ç.', '–î–∞ –≤–æ—Ç, —Å–∫—É—á–∞—é... –†–∞–∑–≤–µ—Å–µ–ª–∏—à—å?', '–í—Å–µ –ø—É—á–∫–æ–º!'] },
    
    // --- –ß–ï–ú –ó–ê–ù–Ø–¢–ê ---
    { keywords: ['—á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è', '—á—Ç–æ –¥–µ–ª–∞–µ—à—å', '—á–µ–º –∑–∞–Ω—è—Ç', '—á–µ –¥–µ–ª–∞–µ—à—å', '—á–µ–º –º–∞–µ—à—å—Å—è', '–¥–≤–∏–∂'], answers: ['–°–º–æ—Ç—Ä—é —Å–µ—Ä–∏–∞–ª üé¨', '–†–∞–±–æ—Ç–∞—é, –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é...', '–õ–µ–∂—É, –∑–∞–ª–∏–ø–∞—é –≤ —Ç–µ–ª–µ—Ñ–æ–Ω üì±', '–î—É–º–∞—é, –∫—É–¥–∞ —Å—Ö–æ–¥–∏—Ç—å –≤–µ—á–µ—Ä–æ–º.', '–ñ–¥—É, –∫–æ–≥–¥–∞ —Ç—ã –Ω–∞–ø–∏—à–µ—à—å —á—Ç–æ-—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ üòâ', '–ù–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ, –±–µ–∑–¥–µ–ª—å–Ω–∏—á–∞—é.'] },
    
    // --- –õ–û–ö–ê–¶–ò–Ø (–ê–õ–ú–ê–¢–´ VIBES) ---
    { keywords: ['–≥–¥–µ –∂–∏–≤–µ—à—å', '—Å –∫–∞–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞', '–∫–∞–∫–æ–π —Ä–∞–π–æ–Ω', '–æ—Ç–∫—É–¥–∞ —Ç—ã', '–≥–æ—Ä–æ–¥', '–∞–¥—Ä–µ—Å'], answers: ['–Ø –≤ —Ü–µ–Ω—Ç—Ä–µ –∂–∏–≤—É üèôÔ∏è', '–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å –≥–æ—Ä–æ–¥–∞.', '–ù–µ–¥–∞–ª–µ–∫–æ –æ—Ç –ê–±–∞—è.', '–í –∑–æ–ª–æ—Ç–æ–º –∫–≤–∞–¥—Ä–∞—Ç–µ üòâ', '–ê–ª–º–∞—Ç—ã ‚Äî –º–æ–π –≥–æ—Ä–æ–¥ ‚ù§Ô∏è', '–ü–æ–∫–∞ —Å–µ–∫—Ä–µ—Ç, –º–∞–Ω—å—è–∫! üòÇ'] },
    
    // --- –í–û–ó–†–ê–°–¢ ---
    { keywords: ['—Å–∫–æ–ª—å–∫–æ –ª–µ—Ç', '–∫–∞–∫–æ–π –≤–æ–∑—Ä–∞—Å—Ç', '—Å—Ç–∞—Ä–∞—è', '–º–æ–ª–æ–¥–∞—è', '–≥–æ–¥', '–≤–æ–∑—Ä–∞—Å—Ç'], answers: ['–í —Å–∞–º–æ–º —Ä–∞—Å—Ü–≤–µ—Ç–µ —Å–∏–ª üòâ', '18 –∏ –±–æ–ª—å—à–æ–π –æ–ø—ã—Ç üòÇ', '–£–≥–∞–¥–∞–π! –î–∞—é 3 –ø–æ–ø—ã—Ç–∫–∏.', '–î–µ–≤—É—à–∫–∞–º —Ç–∞–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–µ –∑–∞–¥–∞—é—Ç!', '–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –±—ã—Ç—å —É–º–Ω–æ–π üòâ'] },
    
    // --- –ö–û–ù–¢–ê–ö–¢–´ ---
    { keywords: ['–∏–Ω—Å—Ç–∞', 'instagram', '–≤–∞—Ç—Å–∞–ø', '–Ω–æ–º–µ—Ä', '—Ç–µ–ª–µ—Ñ–æ–Ω', '—Ü–∏—Ñ—Ä—ã', '—Å—Å—ã–ª–∫—É', '—Ç–≥', '—Ç–µ–ª–µ–≥—Ä–∞–º'], answers: ['–ù–µ —Å–ø–µ—à–∏, –∫–æ–≤–±–æ–π ü§†', '–î–∞–≤–∞–π —Å–Ω–∞—á–∞–ª–∞ —Ç—É—Ç –ø–æ–æ–±—â–∞–µ–º—Å—è?', '–Ø —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–º –¥–∞—é üòâ', '–°–∫–∏–Ω—å —Å–≤–æ–π, —è –ø–æ–¥—É–º–∞—é.', 'Insta: @secret_girl (—à—É—á—É)'] },
    
    // --- –¶–ï–õ–ò ---
    { keywords: ['–∫–æ–≥–æ –∏—â–µ—à—å', '–∑–∞—á–µ–º –∑–¥–µ—Å—å', '—Ü–µ–ª—å', '–∏—â–µ—à—å', '–∑–∞—á–µ–º —Ç—ã —Ç—É—Ç'], answers: ['–ò—â—É —Ç–æ–≥–æ, —Å –∫–µ–º –Ω–µ —Å–∫—É—á–Ω–æ.', '–°–µ—Ä—å–µ–∑–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è ‚ù§Ô∏è', '–ü—Ä–æ—Å—Ç–æ –ø–æ–±–æ–ª—Ç–∞—Ç—å –∑–∞—à–ª–∞.', '–ò—â—É –º—É–∂–∞... –®—É—á—É! –ò–ª–∏ –Ω–µ—Ç? üòâ', '–•–æ—á—É –Ω–∞–π—Ç–∏ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—É—é –¥—É—à—É.'] },
    
    // --- –ö–û–ú–ü–õ–ò–ú–ï–ù–¢–´ (–†–ï–ê–ö–¶–ò–Ø) ---
    { keywords: ['–∫—Ä–∞—Å–∏–≤–∞—è', '–º–∏–ª–∞—è', '—Å—É–ø–µ—Ä', '–∫–ª–∞—Å—Å–Ω–∞—è', '–∫—Ä–∞—Å–æ—Ç–∫–∞', '—Ñ–∏–≥—É—Ä–∞', '—Å–µ–∫—Å–∏', '–æ–≥–æ–Ω—å', '—Å–æ—Å–∫–∞'], answers: ['–û–π, —Å–ø–∞—Å–∏–±–æ ‚ò∫Ô∏è', '–ó–∞—Å–º—É—â–∞–ª –ø—Ä—è–º...', '–¢—ã —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ üòâ', '–Ø –∑–Ω–∞—é üòé', '–ú–µ—Ä—Å–∏, –ø—Ä–∏—è—Ç–Ω–æ —Å–ª—ã—à–∞—Ç—å!', '–ü—Ä–æ–¥–æ–ª–∂–∞–π, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è üòÇ'] },
    
    // --- –§–û–¢–û ---
    { keywords: ['—Å–∫–∏–Ω—å —Ñ–æ—Ç–æ', '—Ñ–æ—Ç–æ', '—Ñ–æ—Ç–∫—É', '—Å–µ–±—è', '–ø–∞–ø–∫—É', '–Ω—é–¥—Å', '—Å–∫–∏–Ω—å —Å–µ–±—è'], answers: ['–í –ø—Ä–æ—Ñ–∏–ª–µ –∂–µ –µ—Å—Ç—å –ª—É—á—à–∏–µ –∫–∞–¥—Ä—ã üì∏', '–Ø –Ω–µ —Å–∫–∏–¥—ã–≤–∞—é —Ñ–æ—Ç–æ –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞–º.', '–ê —Ç—ã –∑–∞—Å–ª—É–∂–∏–ª? üòâ', '–õ–æ–≤–∏ –º—ã—Å–ª–µ–Ω–Ω–æ ü§™', '–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–æ—Ñ–µ!'] },
    
    // --- –õ–ò–ß–ù–û–ï / –û–¢–ù–û–®–ï–ù–ò–Ø ---
    { keywords: ['–µ—Å—Ç—å –ø–∞—Ä–µ–Ω—å', '–º—É–∂', '–∑–∞–Ω—è—Ç–∞', '–æ–¥–Ω–∞', '—Å–≤–æ–±–æ–¥–Ω–∞', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è'], answers: ['–ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Å–≤–æ–±–æ–¥–Ω–æ üíî', '–°–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å...', '–ê —Ç—ã —Å –∫–∞–∫–æ–π —Ü–µ–ª—å—é –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—à—å—Å—è? üòâ', '–ù–µ—Ç, —è —Å–≤–æ–±–æ–¥–Ω–∞.', '–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –±–æ–∏—à—å—Å—è? üòÑ'] },
    
    // --- –í–°–¢–†–ï–ß–ê ---
    { keywords: ['–≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è', '–≥—É–ª—è—Ç—å', '—Å–≤–∏–¥–∞–Ω–∏–µ', '—É–≤–∏–¥–∏–º—Å—è', '–ø–æ–π–¥–µ–º', '–∫–æ—Ñ–µ', '–∫–∏–Ω–æ', '–∫–∞–ª—å—è–Ω', '—É–∂–∏–Ω'], answers: ['–Ø —Ç–æ–ª—å–∫–æ –∑–∞! –ì–¥–µ? ‚òï', '–ü–æ–≥–Ω–∞–ª–∏, –Ω–æ —è –ª—é–±–ª—é –≤–∫—É—Å–Ω—ã–π –∫–æ—Ñ–µ.', '–î–∞–≤–∞–π –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö?', '–ï—Å–ª–∏ —É–≥–æ—â–∞–µ—à—å ‚Äî —è —Å–æ–≥–ª–∞—Å–Ω–∞ üòÇ', '–ü–∏—à–∏ –≤—Ä–µ–º—è –∏ –º–µ—Å—Ç–æ, —è –ø–æ–¥—É–º–∞—é.'] },
    
    // --- –ë–û–¢ –ü–†–û–í–ï–†–ö–ê ---
    { keywords: ['—Ç—ã –±–æ—Ç', '—Ä–æ–±–æ—Ç', '—Ñ–µ–π–∫', '–Ω–µ–π—Ä–æ—Å–µ—Ç—å', '–∏–∏', 'gpt'], answers: ['–Ø —Ä–µ–∞–ª—å–Ω–∞—è! –ü–æ—Ç—Ä–æ–≥–∞—Ç—å –Ω–µ–ª—å–∑—è, –Ω–æ –ø–∏—Å–∞—Ç—å –º–æ–∂–Ω–æ üòú', '–û–±–∏–∂–∞–µ—à—å, —è –∂–∏–≤–∞—è!', '–ù–µ—Ç, —è –ø—Ä–æ—Å—Ç–æ –±—ã—Å—Ç—Ä–æ –ø–µ—á–∞—Ç–∞—é.', '–°–∞–º —Ç—ã –±–æ—Ç!', '–ê —Ç—ã –ø—Ä–æ–π–¥–∏ —Ç–µ—Å—Ç –Ω–∞ —Ä–æ–±–æ—Ç–∞ üö¶'] },
    
    // --- –•–û–ë–ë–ò / –ï–î–ê ---
    { keywords: ['—Ö–æ–±–±–∏', '—É–≤–ª–µ—á–µ–Ω–∏—è', '–ª—é–±–∏—à—å', '–∫—É—à–∞—Ç—å', '–µ–¥–∞', '–ª—é–±–∏–º–æ–µ –±–ª—é–¥–æ'], answers: ['–õ—é–±–ª—é –º—É–∑—ã–∫—É, —Ç–∞–Ω—Ü—ã –∏ –≤–∫—É—Å–Ω—É—é –µ–¥—É üçï', '–û–±–æ–∂–∞—é –≥–æ—Ç–æ–≤–∏—Ç—å... –∏–Ω–æ–≥–¥–∞.', '–ë–µ—à–±–∞—Ä–º–∞–∫ –ª—é–±–ª—é, —è –∂–µ –∫–∞–∑–∞—à–∫–∞! üòÇ', '–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ Netflix.', '–°–ø–ª—é, –µ–º, –ø–æ–≤—Ç–æ—Ä—è—é.'] },
    
    // --- –°–õ–ï–ù–ì –†–ï–ê–ö–¶–ò–ò ---
    { keywords: ['–∞—Ö–∞—Ö', '–ª–æ–ª', '–∫–µ–∫', '—Å–º–µ—à–Ω–æ', '))', 'üòÇ', '–æ—Ä—É', '—É–≥–∞—Ä'], answers: ['–†–∞–¥–∞, —á—Ç–æ —Ç–µ–±–µ –≤–µ—Å–µ–ª–æ üòÑ', '–õ—é–±–ª—é –ø–∞—Ä–Ω–µ–π —Å —á—É–≤—Å—Ç–≤–æ–º —é–º–æ—Ä–∞!', 'üòÇ', ')))))', '–ù—É —Ö–æ—Ç—å —Ä–∞—Å—Å–º–µ—à–∏–ª–∞!'] },
    
    // --- –ù–ï–ì–ê–¢–ò–í / –¢–û–ö–°–ò–ö ---
    { keywords: ['–¥—É—Ä–∞', '—Ç—É–ø–∞—è', '—Å—Ç—Ä–∞—à–Ω–∞—è', '–∏–¥–∏', '–ø–æ—à–ª–∞', '–º—Ä–∞–∑—å'], answers: ['–§—É, –∫–∞–∫ –≥—Ä—É–±–æ üòí', '–ù–µ –ø–æ–∑–æ—Ä—å—Å—è.', '–£–¥–∞—á–∏ —Ç–µ–±–µ —Å —Ç–∞–∫–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º üëã', '–Ø –Ω–∞ —Ç–∞–∫–æ–µ –Ω–µ –æ–±–∏–∂–∞—é—Å—å, –Ω–æ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ.', '–ë–∞–Ω! (—à—É—á—É, –Ω–æ —Ç—ã –Ω–∞—Ä—ã–≤–∞–µ—à—å—Å—è)'] },
    
    // --- –ü–†–û–©–ê–ù–ò–ï ---
    { keywords: ['–ø–æ–∫–∞', '–¥–æ –≤—Å—Ç—Ä–µ—á–∏', '—Å–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏', '—Å–Ω–æ–≤', '–¥–∞–≤–∞–π', '–±–±'], answers: ['–ü–æ–∫–∞-–ø–æ–∫–∞! üëã', '–°–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤!', '–ù–µ –ø—Ä–æ–ø–∞–¥–∞–π!', '–ü–∏—à–∏ –µ—â–µ, –±—É–¥—É –∂–¥–∞—Ç—å üòò', '–¶–µ–ª—É—é!'] }
  ],
  
  kz: [
    // --- –°”ò–õ–ï–ú–î–ï–°–£ ---
    { keywords: ['—Å”ô–ª–µ–º', '—Å–∞–ª–∞–º', '–∞—Å—Å–∞–ª–∞—É–º–∞–≥–∞–ª–µ–π–∫—É–º', '—Ö–∞–π', '“õ–∞–ª “õ–∞–ª–∞–π', '–Ω–µ —Ö–∞–±–∞—Ä'], answers: ['–°”ô–ª–µ–º! üëã', '“ö–∞–ª–∞–π—Å—ã“£?', '–£–∞“ì–∞–ª–µ–π–∫—É–º–∞—Å—Å–∞–ª–∞–º!', '–°”ô–ª–µ–º, –∫”©“£—ñ–ª-–∫“Ø–π “õ–∞–ª–∞–π?', '–°–∞–ª—é—Ç! –ù–µ –∂–∞“£–∞–ª—ã“õ?'] },
    
    // --- “ö–ê–õ-–ñ–ê“í–î–ê–ô ---
    { keywords: ['“õ–∞–ª–∞–π—Å—ã“£', '“õ–∞–ª–∞–π—Å—ã–∑', '–Ω–µ –∂–∞“£–∞–ª—ã“õ', '—Ö–∞–ª—ñ“£ “õ–∞–ª–∞–π', '“õ–∞–ª–∞–π ”©–∑—ñ“£', '—Ç—ã–Ω—ã—à—Ç—ã“õ –ø–∞'], answers: ['–ö–µ—Ä–µ–º–µ—Ç! ”®–∑—ñ“£ “õ–∞–ª–∞–π? üòä', '–®“Ø–∫—ñ—Ä, –±”ô—Ä—ñ –∂–∞“õ—Å—ã. –°–µ–Ω —à–µ?', '–ë”ô—Ä—ñ –æ–π–¥–∞“ì—ã–¥–∞–π!', '–ñ“±–º—ã—Å, “Ø–π... —Å–æ–ª –±–∞—è“ì—ã.', '–ñ–∞–º–∞–Ω –µ–º–µ—Å, ”©–∑—ñ“£–¥–µ —à–µ?'] },
    
    // --- –ù–ï –Ü–°–¢–ï–ü –ñ–ê–¢–´–†–°–´“¢ (–°–õ–ï–ù–ì) ---
    { keywords: ['–Ω–µ —ñ—Å—Ç–µ–ø', '–Ω–µ —ñ—Å—Ç–µ–≤–∞—Ç—Å—ã–Ω', '–Ω–µ—Å—Ç–µ–≤–∞—Ç—Å—ã–Ω', '–Ω–µ—Å—Ç–µ–≤–∞—Ç—Å', '–Ω–µ —ñ—Å—Ç–µ–ø –∂–∞—Ç—ã—Ä—Å—ã“£', '–Ω–µ “õ—ã–ª—ã–ø'], answers: ['–î–µ–º–∞–ª—ã–ø –æ—Ç—ã—Ä–º—ã–Ω üé¨', '–ñ–∞–π, —Ç–µ–ª–µ—Ñ–æ–Ω —à“±“õ—ã–ø...', '–°–µ–Ω—ñ“£ –∂–∞–∑“ì–∞–Ω—ã“£–¥—ã –∫“Ø—Ç—ñ–ø üòâ', '–ú—É–∑—ã–∫–∞ —Ç—ã“£–¥–∞–ø.', '–¢–∞–º–∞“õ—Ç–∞–Ω—ã–ø –æ—Ç—ã—Ä–º—ã–Ω üçï', '–ò–Ω—Å—Ç–∞ –∞“õ—Ç–∞—Ä—ã–ø –∂–∞—Ç—ã—Ä–º—ã–Ω.'] },
    
    // --- –†–£ / –ñ–ï–†–õ–ï–° ---
    { keywords: ['—Ä—É—ã“£', '—Ä—É—ã–Ω', '—Ä—É—ñ“£', '“õ–∞–π –∂“Ø–∑', '—Ä—É—ã“£—ã–∑', '“õ–∞–π –∂–∞“õ'], answers: ['“ö–∞–∑–∞“õ–ø—ã–Ω “ì–æ–π üòÇ', '–†—É —Å“±—Ä–∞—Å–∞“£ —Ç—É—ã—Å –±–æ–ª—ã–ø —à—ã“ì–∞–º—ã–∑!', '–ù–∞–π–º–∞–Ω (“õ–∞–ª–∂—ã“£) üòâ', '“∞–ª—ã –∂“Ø–∑... –¥–µ—Å–µ–º —Å–µ–Ω–µ—Ä –º–µ –µ–¥—ñ“£?', '–û–ª –º–∞“£—ã–∑–¥—ã –º–∞? –ë–∞—Å—Ç—ã—Å—ã –∞–¥–∞–º –±–æ–ª—É!', '–ê–ª–º–∞—Ç—ã–Ω—ã“£ “õ—ã–∑—ã–º—ã–Ω üçé'] },
    
    // --- –ö–û–ù–¢–ê–ö–¢ –°“∞–†–ê–£ ---
    { keywords: ['–∏–Ω—Å—Ç–∞', '–≤–∞—Ç—Å–∞–ø', '–Ω–æ–º–µ—Ä', '—Ç–µ–ª', '–Ω”©–º—ñ—Ä', '–∏–Ω—Å—Ç–∞–≥—Ä–∞–º', 'whats', '—Ü–∏—Ñ—Ä—ã'], answers: ['–ö–µ–π—ñ–Ω—ñ—Ä–µ–∫ –±–µ—Ä–µ–π—ñ–Ω üòâ', '–ê–ª–¥—ã–º–µ–Ω –æ—Å—ã –∂–µ—Ä–¥–µ —Å”©–π–ª–µ—Å–µ–π—ñ–∫.', '–ê—Å—ã“õ–ø–∞—Å–∞–π—à—ã, –∂—ñ–≥—ñ—Ç...', '“ö—ã–∑–¥—ã“£ –Ω”©–º—ñ—Ä—ñ–Ω –∞–ª—É “Ø—à—ñ–Ω –µ“£–±–µ–∫—Ç–µ–Ω—É –∫–µ—Ä–µ–∫ üòé', 'Instagram: @jumbaq_qyz'] },
    
    // --- –ú–ê“ö–°–ê–¢ ---
    { keywords: ['–∫—ñ–º–¥—ñ —ñ–∑–¥–µ–ø', '–º–∞“õ—Å–∞—Ç—ã“£', '–Ω–µ —ñ–∑–¥–µ–ø', '–∂—ñ–≥—ñ—Ç', '—Ç–∞–Ω—ã—Å—É', '–Ω–µ “Ø—à—ñ–Ω'], answers: ['–ñ–∞“õ—Å—ã –∞–¥–∞–º —ñ–∑–¥–µ–ø –∂“Ø—Ä–º—ñ–Ω.', '–°”©–π–ª–µ—Å—ñ–ø –∫”©—Ä–µ–π—ñ–∫, –±”ô–ª–∫—ñ–º —Å–µ–Ω —à—ã“ì–∞—Ä—Å—ã“£...', '–ë–æ–ª–∞—à–∞“õ –∂–∞—Ä—ã–º–¥—ã ‚ù§Ô∏è', '–£–∞“õ—ã—Ç ”©—Ç–∫—ñ–∑—É–≥–µ.', '–ú–∞—Ö–∞–±–±–∞—Ç —ñ–∑–¥–µ–ø –∂“Ø—Ä–º—ñ–Ω ü•∞'] },
    
    // --- –ö–û–ú–ü–õ–ò–ú–ï–ù–¢ ---
    { keywords: ['”ô–¥–µ–º—ñ—Å—ñ“£', '—Å“±–ª—É—Å—ã“£', '–∫“Ø—à—Ç—ñ', '“±–Ω–∞–¥—ã“£', '—Å“±–ª—É', '–∫—Ä–∞—Å–æ—Ç–∫–∞', '—Ç”ô—Ç—Ç—ñ', '–∂–∞–Ω—ã–º', '–∫“Ø–Ω—ñ–º'], answers: ['–†–∞—Ö–º–µ—Ç “Ø–ª–∫–µ–Ω! ‚ò∫Ô∏è', '“∞—è—Ç“õ–∞ “õ–∞–ª–¥—ã—Ä–º–∞—à—ã...', '“ö—É–∞–Ω—ã—à—Ç—ã–º—ã–Ω!', '–°–µ–Ω –¥–µ "–Ω–∏—á–µ" –µ–∫–µ–Ω—Å—ñ“£ üòâ', '–†–∞—Ö–º–µ—Ç, ”©—Ç–µ –∂–∞“ì—ã–º–¥—ã ü•∞', '–ñ–∞–Ω—ã–º –¥–µ–º–µ, ”ô–ª—ñ –µ—Ä—Ç–µ üòÇ'] },
    
    // --- –ö–ï–ó–î–ï–°–£ / –¢–ê–ú–ê“ö ---
    { keywords: ['–∫–µ–∑–¥–µ—Å–µ–π—ñ–∫', '“õ—ã–¥—ã—Ä–∞–π—ã“õ', '—à—ã“ì–∞–π—ã“õ', '–∂–æ–ª—ã“ì–∞–π—ã“õ', '–∫–æ—Ñ–µ', '—à–∞–π', '—Ç–∞–º–∞“õ'], answers: ['–ö–µ—Ç—Ç—ñ–∫! “ö–∞–π –∂–µ—Ä–≥–µ? ‚òï', '“ö–∞—à–∞–Ω –±–æ—Å–∞–π—Å—ã“£?', '–î–µ–º–∞–ª—ã—Å—Ç–∞ –±–æ–ª–∞–¥—ã!', '–ï—Ç –∞—Å—Å–∞“£ –±–∞—Ä–∞–º—ã–Ω üòÇ', '–ê–ª–º–∞—Ç—ã–Ω—ã“£ “õ–∞–π –∂–µ—Ä—ñ–Ω–¥–µ?'] },
    
    // --- –ë–û–¢ ---
    { keywords: ['–±–æ—Ç', '—Ä–æ–±–æ—Ç', '—Ñ–µ–π–∫', '”©—Ç—ñ—Ä—ñ–∫'], answers: ['–ñ–æ“õ, –º–µ–Ω —Ç—ñ—Ä—ñ –∞–¥–∞–º–º—ã–Ω! üò°', '“ö–æ–π—à—ã, “õ–∞–ª–∂—ã“£–¥–∞–º–∞', '–ë–æ—Ç –µ–º–µ—Å–ø—ñ–Ω, –∂“Ø—Ä–µ–≥—ñ–º –±–∞—Ä ‚ù§Ô∏è', '–°–µ–Ω ”©–∑—ñ“£ –±–æ—Ç —à—ã“ì–∞—Ä—Å—ã“£?'] },
    
    // --- –°–õ–ï–ù–ì –†–ï–ê–ö–¶–ò–Ø–õ–ê–† (KZ) ---
    { keywords: ['–±–∞–∑–∞—Ä –∂–æ“õ', '—Ç–µ–º–∞', '–∑—ã“£', '–∂—ã—ã–Ω–¥—ã', '–∫“Ø—à—Ç—ñ', '–∂–∞—Ä–∞–π—Å—ã“£', '–∫—Ä–∞—Å–∞–≤—á–∏–∫'], answers: ['”ò“£–≥—ñ–º–µ –∂–æ“õ “õ–æ–π üòé', '”®–∑—ñ“£ –¥–µ –∑—ã“£—Å—ã“£!', '–†–∞—Ö–º–µ—Ç!', '–°—Ç–∞—Ä–∞—é—Å—å üòâ', '–°–µ–Ω–µ–Ω “Ø–π—Ä–µ–Ω–¥—ñ–º “ì–æ–π!'] },
    
    // --- –ö“Æ–õ–ö–Ü ---
    { keywords: ['–∞—Ö–∞—Ö', '—Ö–µ—Ö–µ', '—Ö–∏—Ö–∏', '–∫“Ø–ª–∫—ñ–ª—ñ', '))', 'üòÇ', '“õ–∞—Ç—Ç—ã'], answers: ['–ö“Ø–ª–≥–µ–Ω —Å–∞“ì–∞–Ω –∂–∞—Ä–∞—Å–∞–¥—ã üòÑ', '“ö—ã–∑—ã“õ –∏”ô?', 'üòÇ', ')))))', '–ö”©“£—ñ–ª-–∫“Ø–π—ñ–º –∫”©—Ç–µ—Ä—ñ–ª—ñ–ø “õ–∞–ª–¥—ã.', '–ñ–∞—Ä—ã–ª–¥—ã–º ü§£'] },
    
    // --- –ñ–ê“í–´–ú–°–´–ó ---
    { keywords: ['“õ—É–º–∞', '–º–∞–ª', '—Ç–æ–ø–∞—Å', '–∫–µ—Ç—à—ñ', '–∂—ã–Ω–¥—ã', '–∞“õ—ã–º–∞“õ'], answers: ['–ú”ô–¥–µ–Ω–∏–µ—Ç—Ç—ñ –±–æ–ª–∞–π—ã“õ!', '–°–∞–±—ã—Ä, —Å–∞–±—ã—Ä...', '–ù–µ–≥–µ –±–æ“õ—Ç–∞–π—Å—ã“£? üò≥', '–ñ–∞“õ—Å—ã —Å”©–∑ - –∂–∞—Ä—ã–º —ã—Ä—ã—Å.', '–°–∞—É –±–æ–ª—à—ã, –Ω–µ–≥–∞—Ç–∏–≤ –∫–µ—Ä–µ–∫ –µ–º–µ—Å.'] },
    
    // --- “ö–û–®–¢–ê–°–£ ---
    { keywords: ['—Å–∞—É –±–æ–ª', '–∫”©—Ä—ñ—Å–∫–µ–Ω—à–µ', '“õ–∞–π—ã—Ä–ª—ã —Ç“Ø–Ω', '–∂–∞“õ—Å—ã –∂–∞—Ç', '–∫–µ—Ç—Ç—ñ–º', '“±–π—ã“õ—Ç–∞–π–º'], answers: ['–°–∞—É –±–æ–ª! üëã', '–•–∞–±–∞—Ä–ª–∞—Å!', '–ñ–∞“õ—Å—ã –¥–µ–º–∞–ª!', '–¢“Ø—Å—ñ“£–¥–µ –º–µ–Ω—ñ –∫”©—Ä üòâ', '“ö–∞–π—ã—Ä–ª—ã —Ç“Ø–Ω üåô'] }
  ]
};
    const defaultReplies = {
      ru: ['–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...', '–†–∞—Å—Å–∫–∞–∂–∏ –µ—â–µ üòÑ', '–•–º–º, –ø–æ–Ω—è—Ç–Ω–æ.', '–ü—Ä–∏–∫–æ–ª—å–Ω–æ!', '–î–∞ –ª–∞–¥–Ω–æ?', '–°–µ—Ä—å–µ–∑–Ω–æ? üòØ', '–ê—Ö–∞—Ö, —Ç–æ—á–Ω–æ!', '–°–ª—É—à–∞–π, –∞ —Ç—ã —á–∞—Å—Ç–æ —Ç—É—Ç —Å–∏–¥–∏—à—å?'],
      kz: ['“ö—ã–∑—ã“õ –µ–∫–µ–Ω...', '–¢–∞“ì—ã –Ω–µ –∞–π—Ç–∞—Å—ã“£? üòÑ', '–¢“Ø—Å—ñ–Ω—ñ–∫—Ç—ñ.', '–ö“Ø—à—Ç—ñ!', '–ú”ô—Å—Å–∞“ì–∞–Ω!', '–®—ã–Ω –±–∞? üòØ', '–ê—Ö–∞—Ö, –∏”ô!', '–ú“±–Ω–¥–∞ –∂–∏—ñ –∫—ñ—Ä–µ—Å—ñ“£ –±–µ?']
    };
    function getSmartReply(text) {
      const lower = text.toLowerCase();
      const currentLang = lang === 'kz' ? 'kz' : 'ru'; 
      const patterns = chatPatterns[currentLang];
      for (let p of patterns) {
        if (p.keywords.some(k => lower.includes(k))) return p.answers[Math.floor(Math.random() * p.answers.length)];
      }
      const defaults = defaultReplies[currentLang];
      return defaults[Math.floor(Math.random() * defaults.length)];
    }
    function sendMessage() {
      if (!currentChatId) return;
      const input = $('#chatInput');
      const text = input.value.trim();
      if (!text) return;
      chats[currentChatId] = chats[currentChatId] || [];
      chats[currentChatId].push({ me: true, text, ts: Date.now() });
      input.value = '';
      renderChat();
      save();
      setTimeout(() => {
        const replyText = getSmartReply(text);
        chats[currentChatId].push({ me: false, text: replyText, ts: Date.now() });
        renderChat();
        save();
      }, 800 + Math.random() * 1000); 
    }

    function renderGifts() {
      const grid = $('#giftsGrid'); const modalGrid = $('#giftModalGrid'); grid.innerHTML = ''; modalGrid.innerHTML = '';
      gifts.forEach((g, i) => {
        const name = lang === 'kz' ? g.nameKz : g.nameRu;
        const card = document.createElement('div'); card.className = 'gift';
        card.innerHTML = `<span class="gift-emoji">${g.emoji}</span><p class="gift-name">${name}</p><span class="gift-cost">‚≠ê ${g.cost}</span>`;
        card.onclick = () => { giftTarget = currentProfile(); openGiftModal(); };
        grid.appendChild(card);
        const card2 = card.cloneNode(true); card2.onclick = () => buyGift(i); modalGrid.appendChild(card2);
      });
    }

    function openGiftModal() { giftTarget = giftTarget || currentProfile(); if (!giftTarget) return; openModal('giftModal'); }
    function buyGift(giftIndex) {
      const g = gifts[giftIndex]; if (!giftTarget) return;
      if (starBalance < g.cost) { toast('‚ö†Ô∏è', 'Not enough ‚≠ê'); return; }
      starBalance -= g.cost; updateBadges(); save(); closeModal('giftModal'); triggerGiftAnimation(g.emoji); toast('üéÅ', t('toast_gift'));
      if (Math.random() < 0.55) createMatch(giftTarget);
    }

    function triggerGiftAnimation(emoji) {
      const container = document.createElement('div');
      container.className = 'gift-anim-container';
      const main = document.createElement('div');
      main.textContent = emoji;
      main.className = 'gift-anim-main';
      container.appendChild(main);
      const particles = ['‚ú®', '‚≠ê', 'üíñ', 'üí•', 'üåü', 'üí´', '‚ö°', 'üéâ', 'üéä', 'üíù'];
      for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.textContent = particles[Math.floor(Math.random() * particles.length)];
        p.className = 'gift-particle';
        const angle = (i / 30) * Math.PI * 2 + Math.random() * 0.3;
        const dist = 180 + Math.random() * 250;
        p.style.setProperty('--tx', `${Math.cos(angle) * dist}px`);
        p.style.setProperty('--ty', `${Math.sin(angle) * dist}px`);
        p.style.setProperty('--tr', `${Math.random() * 1080}deg`);
        p.style.animationDelay = (Math.random() * 0.4) + 's';
        container.appendChild(p);
      }
      const hearts = ['üíï', 'üíñ', 'üíó', 'üíì', 'üíù', '‚ù§Ô∏è', 'üíô', 'üíö', 'üíõ', 'üß°'];
      for (let i = 0; i < 16; i++) {
        const heart = document.createElement('div');
        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
        heart.className = 'gift-heart';
        const angle = (i / 16) * Math.PI * 2;
        const dist = 140 + Math.random() * 100;
        heart.style.setProperty('--hx', `${Math.cos(angle) * dist}px`);
        heart.style.setProperty('--hy', `${Math.sin(angle) * dist}px`);
        heart.style.setProperty('--hr', `${Math.random() * 720 - 360}deg`);
        heart.style.animationDelay = (i * 0.04) + 's';
        container.appendChild(heart);
      }
      const confettiColors = ['#FF4757', '#ff6b81', '#5352ed', '#2ed573', '#ffa502', '#ff6348', '#f368e0', '#48dbfb', '#ff9ff3', '#feca57', '#ee5a6f', '#c44569', '#786fa6', '#f8b500', '#63cdda'];
      for (let i = 0; i < 40; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'gift-confetti';
        confetti.style.backgroundColor = confettiColors[Math.floor(Math.random() * confettiColors.length)];
        confetti.style.setProperty('--cx', `${(Math.random() - 0.5) * 600}px`);
        confetti.style.setProperty('--cr', `${Math.random() * 1080}deg`);
        confetti.style.animationDelay = (Math.random() * 0.8) + 's';
        container.appendChild(confetti);
      }
      for (let i = 0; i < 8; i++) {
        const star = document.createElement('div');
        star.textContent = ['‚≠ê', 'üåü', '‚ú®'][Math.floor(Math.random() * 3)];
        star.className = 'gift-star';
        star.style.animationDelay = (i * 0.15) + 's';
        container.appendChild(star);
      }
      const ringColors = ['rgba(255, 71, 87, 0.7)', 'rgba(83, 82, 237, 0.7)', 'rgba(46, 213, 115, 0.7)', 'rgba(255, 165, 2, 0.7)'];
      for (let i = 0; i < 4; i++) {
        const ring = document.createElement('div');
        ring.className = 'gift-ring';
        ring.style.borderColor = ringColors[i];
        ring.style.animationDelay = (i * 0.2) + 's';
        container.appendChild(ring);
      }
      for (let i = 0; i < 20; i++) {
        const sparkle = document.createElement('div');
        sparkle.textContent = '‚ú®';
        sparkle.className = 'gift-sparkle';
        const angle = Math.random() * Math.PI * 2;
        const dist = 100 + Math.random() * 150;
        sparkle.style.setProperty('--sx', `${Math.cos(angle) * dist}px`);
        sparkle.style.setProperty('--sy', `${Math.sin(angle) * dist}px`);
        sparkle.style.animationDelay = (Math.random() * 0.5) + 's';
        container.appendChild(sparkle);
      }
      document.body.appendChild(container);
      setTimeout(() => { if (container.isConnected) container.remove(); }, 4000);
    }
    
    function renderInterests() {
      const container = $('#interestContainer'); container.innerHTML = '';
      interestCategories.forEach(key => {
        const label = t(key); const el = document.createElement('div'); el.className = 'interest-tag' + (myInterests.includes(key) ? ' selected' : '');
        el.textContent = label; el.onclick = () => toggleInterest(key); container.appendChild(el);
      });
    }
    function toggleInterest(key) { if (myInterests.includes(key)) myInterests = myInterests.filter(k => k !== key); else myInterests.push(key); renderInterests(); }
    
    function handleFileSelect(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader(); reader.onload = function(evt) { myPhoto = evt.target.result; updatePhotoPreview(myPhoto); toast('üì∑', 'OK'); }; reader.readAsDataURL(file);
    }
    function updatePhotoPreview(src) {
      const preview = $('#photoPreview'); const meAvatar = $('#meAvatar');
      if (src) { preview.style.display = 'block'; preview.style.backgroundImage = `url(${src})`; meAvatar.textContent = ''; meAvatar.style.backgroundImage = `url(${src})`; }
      else { preview.style.display = 'none'; meAvatar.textContent = 'üë§'; meAvatar.style.backgroundImage = 'none'; }
    }

    function verifyProfile() { isVerified = true; updateMe(); updateBadges(); save(); toast('üì∏', t('toast_verified')); }
    function updateMe() { const n = $('#inpName').value.trim() || 'User'; const c = $('#inpCity').value || '‚Äî'; $('#meName').textContent = n; $('#meCity').textContent = c; }
    
    // ==========================================================
    // UPDATED RENDER ONLINE FUNCTION (With photos)
    // ==========================================================
    function renderOnline() {
      const list = $('#onlineList'); list.innerHTML = '';
      
      // Filter for online users only
      const onlineUsers = allProfiles.filter(p => p.online).slice(0, 6);
      
      onlineUsers.forEach(p => {
        const el = document.createElement('div'); el.className = 'mini';
        el.onclick = () => {
          const inFiltered = filteredProfiles.findIndex(x => x.id === p.id);
          if (inFiltered >= 0) idx = inFiltered; else { filteredProfiles = [...allProfiles]; idx = allProfiles.findIndex(x => x.id === p.id); $('#citySelect').value = ''; }
          photoIdx = 0; showSection('browse'); displayProfile(); toast('üü¢', `${p.name} online`);
        };
        
        // Logic for Avatar Image
        let avatarStyle = '';
        let avatarContent = p.emoji;
        
        if (p.image && p.image.startsWith('http')) {
          // If image link exists, use it as background
          avatarStyle = `background-image: url('${p.image}'); background-size: cover; background-position: center;`;
          avatarContent = ''; // Remove emoji
        } else {
          // Fallback to gradient
          avatarStyle = `background: ${photoGradients[p.id % photoGradients.length]};`;
        }
        
        el.innerHTML = `
          <div class="avatar" style="${avatarStyle}">
            ${avatarContent}
            <div class="online-dot"></div>
          </div>
          <div style="min-width:0;">
            <div class="mname" style="font-weight:700;">${p.name}</div>
            <div class="mmeta" style="font-size:12px; color:var(--text-sub);">üìç ${p.city}</div>
          </div>
        `;
        list.appendChild(el);
      });
    }

    function openModal(id) { $('#' + id).classList.add('active'); }
    function closeModal(id) { $('#' + id).classList.remove('active'); }
    function modalBackdropClose(e, id) { if (e.target.id === id) closeModal(id); }

    function init() {
      const theme = localStorage.getItem('dhp_theme') || 'light'; document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.setAttribute('data-lang', lang);
      shuffle(allProfiles); filteredProfiles = [...allProfiles];
      renderDots(4); 
      renderOnline(); // Call Updated Function
      renderGifts(); renderMatches(); displayProfile();
      load(); updateMe(); updateBadges(); applyI18n();
      $('#verifiedSmall').textContent = isVerified ? '‚úì' : '‚Äî';
      $('#profileForm').addEventListener('submit', (e) => { e.preventDefault(); updateMe(); save(); toast('üíæ', t('toast_saved')); });
      $('#chatInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); sendMessage(); } });
    }

    window.toggleTheme = toggleTheme; window.toggleLang = toggleLang; window.showSection = showSection; window.filterByCity = filterByCity;
    window.nextPhoto = nextPhoto; window.prevPhoto = prevPhoto; window.like = like; window.skip = skip; window.superLike = superLike;
    window.openGiftModal = openGiftModal; window.closeModal = closeModal; window.modalBackdropClose = modalBackdropClose; window.buyGift = buyGift;
    window.openChat = openChat; window.sendMessage = sendMessage; window.verifyProfile = verifyProfile; window.simulateRealtimeMatch = simulateRealtimeMatch;
    window.handleFileSelect = handleFileSelect; window.toggleInterest = toggleInterest;

    init();
  </script>
</body>

</html>
